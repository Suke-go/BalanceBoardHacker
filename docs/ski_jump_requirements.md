# スキージャンプ VR 実装要件

## 概要

Balance Board + Bass Shaker を用いたスキージャンプ体験。前傾/後傾でスピード制御、滑走振動をハプティクスで再現。

## ノーマルヒル仕様 (K90)

| パラメータ | 値 | 説明 |
|------------|-----|------|
| Hill Size (HS) | 100m | テイクオフ → 着地エリア末端 |
| K-point | 90m | 着地目標点 |
| アプローチ角 | 36° | 助走路の傾斜 |
| テイクオフテーブル | 10° | ジャンプ台の角度 |
| 着地斜面 | 32° | K点での着地角 |

**簡易化**: デモ用に5°傾斜の雪山で表現。

---

## 機能要件

### FR-01: 姿勢によるスピード制御

| 姿勢 | CoP Y | 効果 |
|------|-------|------|
| 前傾 | Y > +20mm | 加速（空気抵抗減） |
| 中立 | -20 < Y < +20mm | 現速度維持 |
| 後傾 | Y < -20mm | 減速（空気抵抗増） |

**物理モデル**:
```
加速度 = 重力 × sin(5°) - 空気抵抗 × f(姿勢)
空気抵抗係数 = 0.3 (前傾) / 0.5 (中立) / 0.8 (後傾)
```

### FR-02: 滑走振動フィードバック

**研究に基づく振動特性**:
- **周波数帯域**: 16-40 Hz（雪面の不整による振動）
- **スピード依存性**: 速度に比例して振幅増加
- **テクスチャ**: 帯域制限ノイズ（BandLimitedNoise）

**実装**:
```
振動振幅 = 速度 / 最高速度 × 最大振幅
振動周波数 = 20Hz (固定) + 速度×0.2Hz (微調整)
```

### FR-03: ジャンプタイミング検出

**トリガー条件**:
- プレイヤーがテイクオフテーブル末端を通過
- または急速な前傾→ニュートラル遷移

**ジャンプ時の処理**:
1. 振動を即座に停止
2. 飛行フェーズに遷移
3. 飛距離計算開始

### FR-04: 飛行フェーズ

- **姿勢制御**: 前傾 = 飛距離伸びる、後傾 = 落下加速
- **振動なし**: 静寂を体感
- **着地判定**: 着地斜面との衝突検出

---

## ゲームフロー

```
[スタート] → [滑走開始] → [スピード調整] → [テイクオフ] → [飛行] → [着地] → [結果表示]
    │              │              │              │
    ▼              ▼              ▼              ▼
  振動開始      振動強度↑      振動停止       Score表示
```

---

## Unity実装構成

```
Assets/
├── Scripts/
│   ├── TheGroundManager.cs     # CoP受信
│   ├── SkiJumpController.cs    # メインロジック
│   ├── HapticController.cs     # 振動制御
│   └── PhysicsSimulator.cs     # 物理計算
├── Scenes/
│   └── SkiJump.unity
└── Prefabs/
    ├── Skier.prefab
    ├── JumpHill.prefab
    └── SnowMountain.prefab
```

---

## ハプティクス仕様

| フェーズ | 振動 | 周波数帯域 | 振幅 |
|----------|------|------------|------|
| 待機 | OFF | - | - |
| 滑走 | **SnowTexture** | 16-120Hz (3バンド) | 速度比例 |
| ジャンプ | **OFF** | - | - |
| 着地衝撃 | Pulse | 30Hz | 1.0 (0.2秒) |

### SnowTexture 波形仕様

| バンド | 周波数 | 役割 | 速度依存性 |
|--------|--------|------|------------|
| Low | 16-24Hz | スキー板の曲げ振動 | 常に 50-80% |
| Mid | 25-40Hz | 雪粒との相互作用 | 20-70% |
| High | 80-120Hz | 氷結晶/硬い雪 | 0-40% (二乗) |

**実装済み**: `SineWaveGenerator.SignalType.SnowTexture`

---

## 技術ポイント

1. **位相同期不要**: 滑走振動はノイズなので位相同期不要
2. **遅延許容**: 振動制御は±50ms許容
3. **フェイルセーフ**: Quest接続断でも振動自動停止

---

## 非機能要件

| 項目 | 目標 |
|------|------|
| フレームレート | 72Hz (Quest 2/3) |
| コントロール遅延 | <100ms |
| 体験時間 | 30秒/ジャンプ |
