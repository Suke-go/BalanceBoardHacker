# 技術要件定義書

## 1. 目的

振動ハプティクスを用いた姿勢フィードバック研究において、振動刺激とCoP計測の同時実行を可能にする。

## 2. 機能要件

### 2.1 CoP計測

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-01 | Wii Balance Boardからのセンサ値取得（60Hz） | 必須 |
| FR-02 | 4点ロードセルからCoP (X, Y) を計算 | 必須 |
| FR-03 | 3秒間平均によるキャリブレーション | 必須 |
| FR-04 | 重量のゼロ点補正（風袋引き） | 必須 |

### 2.2 振動出力

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-05 | 任意周波数の正弦波出力（10-80Hz） | 必須 |
| FR-06 | 帯域制限ホワイトノイズ出力 | 推奨 |
| FR-07 | 2チャンネル独立制御 | 必須 |
| FR-08 | リアルタイム振幅制御 | 必須 |

### 2.3 信号分離

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-09 | ローパスフィルタによる姿勢成分抽出（fc=6Hz） | 必須 |
| FR-10 | 適応干渉除去（NLMS） | 必須 |
| FR-11 | マルチハーモニクス補正（f, 2f, 3f） | 推奨 |
| FR-12 | 収束検出とSNR計算 | 推奨 |

### 2.4 可視化

| ID | 要件 | 優先度 |
|----|------|--------|
| FR-13 | CoP軌跡のリアルタイム表示 | 必須 |
| FR-14 | Raw/Filtered切り替え表示 | 必須 |
| FR-15 | センサ値・重量表示 | 必須 |
| FR-16 | 補正状態（SNR, 収束）表示 | 推奨 |

## 3. 非機能要件

### 3.1 性能

| ID | 要件 | 目標値 |
|----|------|--------|
| NFR-01 | UI更新レート | ≥30 FPS |
| NFR-02 | 処理遅延 | <50 ms |
| NFR-03 | 補正収束時間 | <5 秒 |

### 3.2 精度

| ID | 要件 | 目標値 | 根拠 |
|----|------|--------|------|
| NFR-04 | CoP分解能 | ±0.1 mm | ISPGR推奨 |
| NFR-05 | SNR改善 | ≥10 dB | 振動成分1/10以下 |

### 3.3 互換性

| ID | 要件 |
|----|------|
| NFR-06 | Windows 10/11対応 |
| NFR-07 | .NET 8.0ランタイム |
| NFR-08 | x86/x64アーキテクチャ |

## 4. 制約条件

- Wii Balance Boardのサンプリングレートは60Hz固定
- Bluetoothドライバの互換性問題あり（32feet.NETで回避）
- 振動周波数はCoP帯域（0-6Hz）より十分高いこと（推奨≥20Hz）

## 5. 将来拡張

- [ ] データログ・CSV出力
- [ ] Unity連携（OSC/UDP）
- [ ] 複数Balance Board対応
- [ ] 自動パラメータ最適化
